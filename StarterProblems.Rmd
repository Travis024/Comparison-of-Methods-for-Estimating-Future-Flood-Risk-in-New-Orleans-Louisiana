---
title: "Starter Problems Code"
---
```{r}
#PROBLEM 1

#Plot a probability density function of a GEV
#Use either revd, devd, qevd, or pevd
#Bounds on horizontal axis of [0,8]

library(extRemes)
x = revd(10000,loc=2,scale=0.75,shape=0)
hist(x,prob=T)
lines(density(x))
```

```{r}
#PROBLEM 3

#Find the CDF of the above PDF where loc = 2, scale = 0.75, shape = 0
#Evaluate at X = 4 (in this case, the fifth element)
#Subtract from 1 because pevd gives us the probability UNDER 4
cdfVector <- pevd(0:8, 2, 0.75, 0)
1-cdfVector[5]
```

```{r}
#PROBLEM 8

#Set up a data frame for parameter values and years 2000 - 2100
#Make a plot of μ(t)

#Begin by creating the data frame
#Vectors of each paramter and the years
#Fill in mu using the given equation
	year <- c(2000:2100)
  sigma <- seq(0.75, 0.75, length.out = 101)
	xi <- seq(0, 0, length.out = 101)
	mu <- c()
	
mu[1] = 2
for(i in 2:101) {mu[i] = mu[1] + .004 * i} 
parameterData <- data.frame(year, mu, sigma, xi)

#Now, create the graph
	with(parameterData, plot(year, mu, type = "l", xlab = "Year", ylab = "μ(t) [meters]"))
	axis(side = 1, at=c(2010, 2030, 2050, 2070, 2090), labels = c("", "", "", "", ""), tck = -0.05)
```

```{r}
#PROBLEM 9

#Compute the PDF of an evenly spaced grid of sea levels for each year
#Store the PDF values in a dat frame
#One dimension corresponds to sea-level
#The other corresponds to the year

#Begin by creating the sea levels
seaLevelValues <- seq(0, 8, by = 0.05)

#Now create a data frame; 1:101 represents 2000 - 21000
seaLevelPDF <- as.data.frame(matrix(nrow = 17, ncol = 101))

#Fill in the PDF using the changing parameters and the devd function
for(i in 1:101){
    newMu = parameterData[i, "mu"]
    newSigma = parameterData[i, "sigma"]
    newXi = parameterData[i, "xi"]
    seaLevelVector = devd(seaLevelValues, newMu, newSigma, newXi)
    for(j in 1:161){
        seaLevelPDF[j,i] = seaLevelVector[j]
    }
}
```

```{r}
#PROBLEM 10

#Make a plot of 2000, 2020, 2040, 2060 2080, 2100
#All should be on the same graph


#Start by making a plot - graph the pdf for 2000 first
#This function contains all labelling
plot(seaLevelValues, seaLevelPDF[,1], col = "blue", type = "l", main = "Probability Density Functions Over Time Given Changing Parameters", xlab = "Sea Level [meters]", ylab = "f(x)")

#Create a legen for the plot
legend("topright", "Year", c("2000", "2020", "2040", "2060", "2080", "2100"), fill = c("blue", "red", "yellow", "green", "orange", "pink"), horiz = TRUE, cex = .75)

#To graoh on the same plot, use the lines() function for the remaining 5 PDF's
lines(seaLevelValues, seaLevelPDF[,21], col = "red")

lines(seaLevelValues, seaLevelPDF[,41], col = "yellow")

lines(seaLevelValues, seaLevelPDF[,61], col = "green")

lines(seaLevelValues, seaLevelPDF[,81], col = "orange")

lines(seaLevelValues, seaLevelPDF[,101], col = "pink")

```

```{r}
#PROBLEM 11

#For each year, compute the probabiity of a seas level such that X > 4
#Then make a plot of annual excedance probability over time

#Create a vector to store all probabilities
annualExcedance <- c()

#Calculate all of the probabilities and append to our vector
for(i in 1:101){
  
  #Get the new parameter values for the given year
  newMu <- parameterData[i, "mu"]
  newSigma <- parameterData[i, "sigma"]
  newXi <- parameterData[i, "xi"]
  
  #Find the probability at X = 4 using the index 81 (since sealevels steps by 0.05 from 0 to 8)
  #Subtract from 1 because pevd gives us the probaility UNDER a given point
  probabilityVector = pevd(seaLevelValues, newMu, newSigma, newXi)
  excedanceProbability = 1 - probabilityVector[81]
  
  #Append to the vector
  annualExcedance <- append(annualExcedance, excedanceProbability)
}


#Create the graph
plot(year, annualExcedance, type = "l", main = "Annual Exceedance Probability Over Time", xlab = "Sea Level [meters]", ylab = "Annual Exceedance Probability")

```

```{r}
#PROBLEM 12

#First, read in a NetCDF file
#To install ncdf4, use the following:
#install.packages(c('ncdf4'))

library(ncdf4)

#Ensure the file is in the working directory
#getwd()

#Open the NetCDF file and store in a variable
ncin <- nc_open("StarterProblemsNCDF.nc")

#To view the contents of the file, use the following line
#print(ncin)

#Read in from the NetCDF file
gev_stat <- ncvar_get(ncin,"gev_stat")

#View the head - parameters stored as location, scale shape
head(gev_stat)

#Now, make some plots using the different parameters
#Again, we use plot() first and then lines() to get all plots on the same axis
#Note that our range of sea levels is about 300 to 1300 meters
plot(200:1300, devd(200:1300, gev_stat[1,1], gev_stat[1,2], gev_stat[1,3]), type = "l", col = "red", main = "Varying Probability Density Functions From NetCDF With Changing Parameters", xlab = "Sea Level [meters]", ylab = "f(x)", cex.main = 1)

lines(200:1300, devd(200:1300, gev_stat[10,1], gev_stat[10,2], gev_stat[10,3]), type = "l", col = "green")

lines(200:1300, devd(200:1300, gev_stat[20,1], gev_stat[20,2], gev_stat[20,3]), type = "l", col = "blue")

lines(200:1300, devd(200:1300, gev_stat[30,1], gev_stat[30,2], gev_stat[30,3]), type = "l", col = "purple")

lines(200:1300, devd(200:1300, gev_stat[40,1], gev_stat[40,2], gev_stat[40,3]), type = "l", col = "orange")

#Finally, close the file
nc_close(ncin)


```

```{r}
#PROBLEM 13

#Read in another NetCDF file and analysze some of its characteristics

ncin <- nc_open("StarterProblemsNCDF2.nc")

#Look at the file to get a better feel for it
#print(ncin)

#We are mainly interested in LocalSeaLevel_gamma_RCP85 and time_proj
LSL85 <- ncvar_get(ncin, "LocalSeaLevel_gamma_RCP85")
time_proj <- ncvar_get(ncin, "time_proj")

#Poke around with these two varaibles a bit
dim(LSL85)
LSL85[150,800]
length(time_proj)
range(time_proj)

#It appears as though each column in LSL85 is a year between the dates 1850 and 2100
#It appears as though each row in LSL85 is a projection of the change in sea level from the year 2000 using changing GEV parameters and surge factors
```

```{r}
#PROBLEM 14

#Now, using the same NetCDF file, Randomly sample and plot 20 simulations of LSL from each of the RCP2.6, 4.5 and 8.5 scenarios

#Make sure each RCP is loaded in
LSL85 <- ncvar_get(ncin, "LocalSeaLevel_gamma_RCP85")
LSL45 <- ncvar_get(ncin, "LocalSeaLevel_gamma_RCP45")
LSL26 <- ncvar_get(ncin, "LocalSeaLevel_gamma_RCP26")

#We want to make 20 lines for each LSL, so our outer loop runs 20 times
for(i in 1:20){
  
  #For each LSL we initialize a vector that will store the points we sample
  sampleVector85 <- c()
  sampleVector45 <- c()
  sampleVector26 <- c()
  
  #For each year from 2000 to 2100 we pull a sample point from the LSL
  for(j in 150:251){
    sampleVector85 <- append(sampleVector85, sample(LSL85[j,],1))
    sampleVector45 <- append(sampleVector45, sample(LSL45[j,],1))
    sampleVector26 <- append(sampleVector26, sample(LSL26[j,],1))
  }
  
  #This creates the plot - we only want to create one
  if(i == 1){
    plot(time_proj[150:251], sampleVector85, type = "n", main = "Random Sample of Projected Sea Levels for Three RCP Scenarios", xlab = "Year", ylab = "Total Sea Level [m]")
    
    legend("topleft", c("RCP85", "RCP45", "RCP26"), fill = c("red", "light blue", "blue"))
  }
  
  #Fit a lowess line to each of the 20 sample vectors for each of the LSL's (60 lines total)
  lines(lowess(time_proj[150:251], sampleVector85), col = "red")
  lines(lowess(time_proj[150:251], sampleVector45), col = "light blue")
  lines(lowess(time_proj[150:251], sampleVector26), col = "blue")
  
}

```

