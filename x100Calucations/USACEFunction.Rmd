---
title: "USACE Engineers Function"
author: "Travis Torline"

---

```{r}
#This process takes four steps:
#1) Sample a sea-level rise simulation and compute the change in sea level (2016 to 2065)
#2) Sample stationary GEV parameters and compute Xrp (rp = return period)
#3) Sample a surge factor from a unifrom distribution
#4) Construct a realization of X'rp as Xrp + Surge Factor * Change in Sea Level

#Using this process, we will compare the density distribtion of Xrp's to the distribution of X'rp's 

#To begin, we must load in the necessary data:
#Sea level data
#Stationary GEV parameters

library(extRemes)
library(ncdf4)

#The following loads in the sea level data
#LSL 85 has 12,586 sea level projections from 1850 to 2100
ncin <- nc_open("../ncdfFiles/SeaLevelData.nc")

LSL85 <- ncvar_get(ncin, "LocalSeaLevel_gamma_RCP85")

#The following loads in the stationary GEV parameters
params1 <- read.csv(file="../parameters_data/Data Frames/params1.csv", header=TRUE, sep=",") #All stationary

#Finally, load in a time projection
timeProj <- ncvar_get(ncin, "time_proj")

#Now we create our function, which will complete the 4 steps outlined above
#As inputs, it will take seaLevelData, parametersData, timeProj, iterations, yearStart, yearEnd, returnPeriod, uniformStart, and uniformEnd
#seaLevelData = sea level projections IN MILIMETERS
#parametersData = stationary GEV parameters IN MILIMETERS
#timeProj = a vector of years for which there is sea level data
#iterations = how many times to go through the above 4 steps
#yearStart = starting year
#yearEnd = ending year
#returnPeriod = The yearly magnitude of the storm (example, a 1 in 1oo year storm has a return period of 100)
#uniformStart = the starting number for the uniform distribution
#uniformEnd = the ending number for the uniform distribution

generateUSACE <- function(seaLevelData, paramatersData, timeProj, iterations = 1, yearStart = 2016, yearEnd = 2065, returnPeriod = 100, uniformStart, uniformEnd){
  
  #Begin by sampling from the seaLevelData
  #Generate a random index and calculate the change from yearStart to yearEnd
  sampleIndex <- sample(1:ncol(seaLevelData), 1)
  startRow = which(timeProj == yearStart)
  endRow = which(timeProj == yearEnd)
  
  seaLevelChange <- (seaLevelData[endRow, sampleIndex] - seaLevelData[startRow, sampleIndex])
  
  #Now, sample the GEV parameters
  sampleIndex = sample(1:nrow(paramatersData), 1)
  sampleMu <- paramatersData[sampleIndex, "u"]
  sampleSigma <- paramatersData[sampleIndex, "s"]
  sampleXi <- paramatersData[sampleIndex, "xi"]
  

  #Finally, sample from the uniform distribution
  sampleUniform <- runif(1, uniformStart, uniformEnd)
  
}

generateUSACE(LSL85 * 1000, params1, timeProj, uniformStart = 2, uniformEnd = 10)
```

